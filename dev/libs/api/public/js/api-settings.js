$((function(){"use strict";var e=$("#api-settings-container"),t=e.data("upload-service-account-url"),n=e.data("remove-service-account-url"),o=e.data("send-notification-url"),a=e.data("device-tokens-stats-url");function i(e,t){var n=$("#service-account-status");e&&t?n.html('\n                <small class="text-success">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1"><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>\n                    '.concat(window.trans.api.service_account_file_label||"Service account file:"," <strong>").concat(t,'</strong>\n                    <span class="text-muted">').concat(window.trans.api.just_uploaded||"(Just uploaded)","</span>\n                </small>\n            ")):n.html('\n                <small class="text-warning">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1"><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 12l4 4m0 -4l-4 4" /></svg>\n                    '.concat(window.trans.api.service_account_not_uploaded||"Service account file is <strong>not uploaded</strong>. Please upload your service account JSON file.","\n                </small>\n            "))}function s(e){var t=window.location.origin+"/api/v1",n='curl -X GET "'.concat(t,'/pages" \\\n     -H "Accept: application/json" \\\n     -H "X-API-KEY: ').concat(e,'"');$("#curl-example").text(n);var o='fetch("'.concat(t,'/pages", {\n    method: "GET",\n    headers: {\n        "Accept": "application/json",\n        "X-API-KEY": "').concat(e,'"\n    }\n})\n.then(response => response.json())\n.then(data => console.log(data));');$("#js-example").text(o)}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=$("#notification-result"),a="success"===e?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2"><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M9 12l2 2l4 -4" /></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 8v4" /><path d="M12 16h.01" /></svg>',i='\n            <div class="alert '.concat("success"===e?"alert-success":"alert-danger",' alert-dismissible fade show" role="alert">\n                ').concat(a,"\n                <strong>").concat(t,"</strong>\n        ");if(n&&"success"===e){var s=(window.trans.api.sent_to_devices||"Sent to: :count devices").replace(":count",n.sent_count||0),r=(window.trans.api.failed_devices||"Failed: :count devices").replace(":count",n.failed_count||0);i+='\n                <div class="mt-2">\n                    <small>\n                        '.concat(s,"<br>\n                        ").concat(r,"\n                    </small>\n                </div>\n            ")}i+='\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="'.concat(window.trans.api.close||"Close",'"></button>\n            </div>\n        '),o.html(i).show(),"success"===e&&setTimeout((function(){o.find(".alert").alert("close")}),5e3)}$(document).on("click","#edit-api-key",(function(e){e.preventDefault();var t=$("#api-key-input"),n=$(this),o=$("#copy-api-key");t.prop("readonly",!1).focus(),n.hide(),o.show(),Apps.showSuccess(window.trans.api.api_key_edit_enabled||"API key field is now editable.")})),$("#generate-api-key").on("click",(function(e){e.preventDefault();var t=$("#api-key-input"),n=$("#edit-api-key"),o=$("#copy-api-key"),a=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<32;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();t.prop("readonly",!1).val(a),n.hide(),o.show(),Apps.showSuccess(window.trans.api.api_key_generated||"API key generated successfully!"),s(a)})),$("#api-key-input").on("input",(function(){var e=$(this).val()||window.trans.api.your_api_key_here||"your-api-key-here";s(e);var t=$("#copy-api-key");e&&e!==(window.trans.api.your_api_key_here||"your-api-key-here")?t.show():t.hide()})),s($("#api-key-input").val()||window.trans.api.your_api_key_here||"your-api-key-here"),$("#upload-service-account-btn").on("click",(function(e){e.preventDefault(),$("#service-account-file-input").click()})),$("#service-account-file-input").on("change",(function(e){var n=e.target.files[0];if(n){if("application/json"!==n.type&&!n.name.toLowerCase().endsWith(".json"))return void Apps.showError(window.trans.api.invalid_json_file||"Please select a valid JSON file.");if(n.size>2097152)return void Apps.showError(window.trans.api.file_size_too_large||"File size must be less than 2MB.");!function(e){var n=new FormData;n.append("service_account_file",e),n.append("_token",$('input[name="_token"]').val());var o=$("#upload-service-account-btn"),a=$("#upload-progress"),s=a.find(".progress-bar");o.prop("disabled",!0),a.show(),s.css("width","0%"),$.ajax({url:t,method:"POST",data:n,processData:!1,contentType:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;s.css("width",t+"%")}}),!1),e},success:function(e){!1===e.error?($("#fcm-service-account-input").val(e.data.path),i(e.data.path,e.data.filename),Apps.showSuccess(window.trans.api.file_uploaded_successfully||"File uploaded successfully!"),setTimeout((function(){window.location.reload()}),1500)):Apps.showError(e.message||window.trans.api.file_upload_error||"Failed to upload file")},error:function(e){var t=window.trans.api.file_upload_error||"Failed to upload service account file";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),Apps.showError(t)},complete:function(){o.prop("disabled",!1),a.hide(),s.css("width","0%"),$("#service-account-file-input").val("")}})}(n)}})),$("#remove-service-account-btn").on("click",(function(e){var t,o;e.preventDefault(),confirm(window.trans.api.confirm_remove_service_account||"Are you sure you want to remove the service account file?")&&(t=$("#remove-service-account-btn"),o=t.html(),t.prop("disabled",!0).html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6l0 -3" /><path d="M16.25 7.75l2.15 -2.15" /><path d="M18 12l3 0" /><path d="M16.25 16.25l2.15 2.15" /><path d="M12 18l0 3" /><path d="M7.75 16.25l-2.15 2.15" /><path d="M6 12l-3 0" /><path d="M7.75 7.75l-2.15 -2.15" /></svg>'),$.ajax({url:n,method:"POST",data:{_token:$('input[name="_token"]').val()},success:function(e){!1===e.error?($("#fcm-service-account-input").val(""),i("",""),Apps.showSuccess(window.trans.api.file_removed_successfully||"File removed successfully!"),setTimeout((function(){window.location.reload()}),1500)):Apps.showError(e.message||window.trans.api.file_remove_error||"Failed to remove file")},error:function(e){var t=window.trans.api.file_remove_error||"Failed to remove service account file";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),Apps.showError(t)},complete:function(){t.prop("disabled",!1).html(o)}}))})),$("#send-notification-btn").on("click",(function(e){e.preventDefault();var t=$(this),n=$("#notification-result"),a=$("#notification-title").val().trim(),i=$("#notification-message").val().trim();if(!a)return Apps.showError(window.trans.api.please_enter_notification_title||"Please enter a notification title."),void $("#notification-title").focus();if(!i)return Apps.showError(window.trans.api.please_enter_notification_message||"Please enter a notification message."),void $("#notification-message").focus();t.prop("disabled",!0),t.find(".ti-send").removeClass("ti-send").addClass("ti-loader"),t.find("span").text(window.trans.api.notification_sending||"Sending..."),n.hide();var s={title:a,message:i,target:$("#notification-target").val(),action_url:$("#notification-action-url").val(),image_url:$("#notification-image-url").val(),_token:$('input[name="_token"]').val()};$.ajax({url:o,method:"POST",data:s,success:function(e){!1===e.error?(r("success",e.message,e.data),$("#notification-title").val(""),$("#notification-message").val(""),$("#notification-target").val("all"),$("#notification-action-url").val(""),$("#notification-image-url").val("")):r("error",e.message,e.data)},error:function(e){var t=window.trans.api.notification_error_occurred||"An error occurred while sending the notification.";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),r("error",t)},complete:function(){t.prop("disabled",!1),t.find(".ti-loader").removeClass("ti-loader").addClass("ti-send"),t.find("span").text(window.trans.api.send_notification||"Send Notification")}})})),$("#send-notification-form input, #send-notification-form textarea, #send-notification-form select").on("keypress",(function(e){if(13===e.which&&!e.shiftKey){if($(this).is("textarea"))return;e.preventDefault(),$("#send-notification-btn").click()}})),$.ajax({url:a,method:"GET",success:function(e){!1===e.error&&e.data&&function(e){var t=$("#notification-send-info");if(t.length&&e.total>0){var n=(window.trans.api.will_send_to_devices||"Will send to :total active devices (:android Android, :ios iOS, :customers customers)").replace(":total",e.total).replace(":android",e.android).replace(":ios",e.ios).replace(":customers",e.customers);t.html('\n                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 9h.01" /><path d="M11 12h1v4h1" /></svg>\n                '.concat(n,"\n            "))}}(e.data)},error:function(){}})}));