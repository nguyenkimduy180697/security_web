(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(t){var o=function(t,o){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,o||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(t)}(t,"string");return"symbol"==e(o)?o:o+""}var n=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=window.GoogleMapsGeocodingConfig||{},this.geocoder=null,this.autocomplete=null,this.debounceTimer=null,this.debounceDelay=1e3,this.init()},o=[{key:"init",value:function(){var e=this;"undefined"!=typeof google&&void 0!==google.maps?(this.geocoder=new google.maps.Geocoder,this.setupAutocomplete(),this.bindEvents()):setTimeout((function(){return e.init()}),100)}},{key:"setupAutocomplete",value:function(){var e=this,t=document.querySelector('input[name="location"]');t||(t=document.querySelector('input[name="address"]')),t&&(this.autocomplete=new google.maps.places.Autocomplete(t,{types:["address"],fields:["place_id","geometry","name","formatted_address","address_components"]}),this.autocomplete.addListener("place_changed",(function(){e.handlePlaceSelection()})),this.styleAutocompleteDropdown())}},{key:"styleAutocompleteDropdown",value:function(){}},{key:"handlePlaceSelection",value:function(){var e=this.autocomplete.getPlace();if(e.geometry){var t=e.geometry.location.lat(),o=e.geometry.location.lng();this.updateCoordinates(t,o);var n=document.querySelector('input[name="location"]');n||(n=document.querySelector('input[name="address"]')),e.formatted_address&&n&&(n.value=e.formatted_address),this.showMessage(this.config.messages.success,"success")}else this.showMessage("No details available for this location","warning")}},{key:"bindEvents",value:function(){var e=this,t=document.querySelector('input[name="location"]');t||(t=document.querySelector('input[name="address"]'));var o=document.querySelector('input[name="latitude"]'),n=document.querySelector('input[name="longitude"]');t&&o&&n&&(this.addGeocodingButton(t),this.config.autoFill&&t.addEventListener("blur",(function(t){setTimeout((function(){!t.target.value.trim()||o.value&&n.value||e.geocodeAddress(t.target.value)}),300)})))}},{key:"addGeocodingButton",value:function(e){var t=this,o=e.closest(".form-group")||e.parentElement;if(!o.querySelector(".geocoding-button")){var n=document.createElement("div");n.className="mt-2";var i=document.createElement("button");i.type="button",i.className="btn btn-info btn-sm geocoding-button",i.innerHTML=this.getMapPinIcon()+" Get Coordinates",i.title="Get latitude and longitude for this location",i.style.cssText="\n            display: inline-flex;\n            align-items: center;\n            gap: 6px;\n            font-size: 12px;\n            padding: 6px 12px;\n            border-radius: 4px;\n            transition: all 0.2s ease;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n        ",i.addEventListener("click",(function(){var o=e.value.trim();o?t.geocodeAddress(o):t.showMessage("Please enter a location first","warning")})),i.addEventListener("mouseenter",(function(){i.style.transform="translateY(-1px)",i.style.boxShadow="0 2px 6px rgba(0,0,0,0.15)"})),i.addEventListener("mouseleave",(function(){i.style.transform="translateY(0)",i.style.boxShadow="0 1px 3px rgba(0,0,0,0.1)"})),n.appendChild(i),o.appendChild(n)}}},{key:"getMapPinIcon",value:function(){return'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />\n            <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" />\n        </svg>'}},{key:"debounceGeocode",value:function(e){var t=this;clearTimeout(this.debounceTimer),!e||e.length<3||(this.debounceTimer=setTimeout((function(){t.geocodeAddress(e)}),this.debounceDelay))}},{key:"geocodeAddress",value:function(e){var t=this;this.geocoder&&e.trim()&&(this.setLoadingState(!0),this.geocoder.geocode({address:e},(function(e,o){if(t.setLoadingState(!1),"OK"===o&&e&&e.length>0){var n=e[0].geometry.location,i=n.lat(),a=n.lng();t.updateCoordinates(i,a),t.showMessage(t.config.messages.success,"success")}else{var r=t.config.messages.noResults;"OVER_QUERY_LIMIT"===o?r="API quota exceeded. Please try again later.":"REQUEST_DENIED"===o?r="API request denied. Please check your API key.":"INVALID_REQUEST"===o&&(r="Invalid request. Please check the location."),t.showMessage(r,"error")}})))}},{key:"updateCoordinates",value:function(e,t){var o=document.querySelector('input[name="latitude"]'),n=document.querySelector('input[name="longitude"]');o&&n&&(o.value=e.toFixed(6),n.value=t.toFixed(6),o.dispatchEvent(new Event("change")),n.dispatchEvent(new Event("change")))}},{key:"setLoadingState",value:function(e){var t=document.querySelector(".geocoding-button");t&&(e?(t.disabled=!0,t.innerHTML=this.getLoadingIcon()+" Getting coordinates...",t.style.opacity="0.7"):(t.disabled=!1,t.innerHTML=this.getMapPinIcon()+" Get Coordinates",t.style.opacity="1"))}},{key:"getLoadingIcon",value:function(){return'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin">\n            <path d="M21 12a9 9 0 11-6.219-8.56"/>\n        </svg>'}},{key:"showMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"undefined"!=typeof Apps&&Apps.showNotice?Apps.showNotice(t,e):"undefined"!=typeof toastr?toastr[t](e):alert(e)}}],o&&t(e.prototype,o),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,o,n}();document.addEventListener("DOMContentLoaded",(function(){window.GoogleMapsGeocodingConfig&&new n})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){window.GoogleMapsGeocodingConfig&&new n})):window.GoogleMapsGeocodingConfig&&new n})();